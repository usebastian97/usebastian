---
interface Props {
  src: string;
  alt: string;
  caption?: string;
  zoom?: boolean;
}

const { src, alt, caption, zoom = true } = Astro.props;
---

<figure class="not-prose my-8">
  <div
    class:list={[
      'overflow-hidden rounded-xl border border-gray-200 bg-gray-50',
      zoom && 'image-zoom cursor-zoom-in',
    ]}
  >
    <img
      src={src}
      alt={alt}
      class="w-full object-cover transition-transform duration-300"
      loading="lazy"
    />
  </div>
  {
    caption && (
      <figcaption class="mt-3 text-center text-sm text-gray-500">{caption}</figcaption>
    )
  }
</figure>

<style>
  .image-zoom:hover img {
    transform: scale(1.02);
  }
</style>

<!-- Full-screen zoom modal -->
<script>
  document.addEventListener('astro:page-load', () => {
    const zoomImages = document.querySelectorAll('.image-zoom');
    
    zoomImages.forEach((container) => {
      container.addEventListener('click', () => {
        const img = container.querySelector('img');
        if (!img) return;
        
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 z-50 flex items-center justify-center bg-black/90 p-4 cursor-zoom-out';
        modal.innerHTML = `
          <img src="${img.src}" alt="${img.alt}" class="max-h-full max-w-full object-contain" />
          <button class="absolute top-4 right-4 text-white hover:text-gray-300 transition-colors" aria-label="Close">
            <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        `;
        
        modal.addEventListener('click', () => modal.remove());
        document.body.appendChild(modal);
      });
    });
  });
</script>
