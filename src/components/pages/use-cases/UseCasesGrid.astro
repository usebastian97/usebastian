---
import { getCollection } from 'astro:content';
import { useTranslations } from '@i18n/utils';
import EmptyState from '@components/ui/EmptyState.astro';

const t = useTranslations('en');

// Fetch all use cases for English
const allUseCases = await getCollection('use-cases', ({ data }) => (data.lang ?? 'en') === 'en');

// Sort by order field
const sortedUseCases = allUseCases.sort((a, b) => (a.data.order ?? 0) - (b.data.order ?? 0));

const categoryLabels = {
  m365: t('usecases.category_m365'),
  'power-platform': t('usecases.category_power_platform'),
  'security-compliance': t('usecases.category_security_compliance'),
  'copilot-governance': t('usecases.category_copilot_governance'),
};
---

{sortedUseCases.length === 0 ? (
  <EmptyState
    icon="ðŸ’¼"
    title="No use cases yet"
    description="New Microsoft 365, Power Platform, and Copilot governance stories are in progress."
    actionText="Explore Projects"
    actionUrl="/projects"
  />
) : (
  <div class="grid gap-6 md:grid-cols-1 lg:grid-cols-3">
  {sortedUseCases.map((useCase) => (
    <div class="usecase-card group relative flex flex-col rounded-lg border-4 border-gray-200 bg-white p-6 shadow-sm transition-all duration-200 hover:shadow-lg">
      <!-- Category Badge -->
      <div class="mb-3">
        <span class="inline-block rounded-full bg-gray-100 px-3 py-1 text-xs font-semibold uppercase tracking-wide text-gray-800">
          {categoryLabels[useCase.data.category] ?? useCase.data.category}
        </span>
      </div>

      <!-- Title -->
      <h3 class="mb-3 text-lg font-bold text-gray-900">
        <a href={`/use-cases/${useCase.slug}`} class="after:absolute after:inset-0 hover:text-blue-600 transition-colors" aria-label={useCase.data.title}>
          {useCase.data.title}
        </a>
      </h3>

      <!-- Description -->
      <p class="mb-4 text-sm leading-relaxed text-gray-600">
        {useCase.data.description}
      </p>

      <!-- Technologies -->
      {useCase.data.technologies.length > 0 && (
        <div class="mb-4">
          <h4 class="mb-2 text-xs font-semibold uppercase tracking-widest text-gray-500">
            {t('usecases.technologies')}
          </h4>
          <div class="flex flex-wrap gap-2">
            {useCase.data.technologies.slice(0, 5).map((tech) => (
              <span class="rounded-full px-3 py-1 text-xs font-medium bg-gray-100 text-gray-700">
                {tech}
              </span>
            ))}
            {useCase.data.technologies.length > 5 && (
              <span class="rounded-full px-3 py-1 text-xs font-medium bg-gray-100 text-gray-700">
                +{useCase.data.technologies.length - 5} more
              </span>
            )}
          </div>
        </div>
      )}

      <!-- View Details Link -->
      <div class="mt-auto flex items-center justify-between border-t border-gray-200 pt-4">
        <span class="text-xs font-medium text-gray-500">
          {categoryLabels[useCase.data.category] ?? useCase.data.category}
        </span>
        <span class="inline-flex items-center gap-1 text-xs font-medium text-blue-600 hover:text-blue-700">
          {t('usecases.viewDetails')}
          <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </span>
      </div>
    </div>
  ))}
  </div>
)}

<style>
  .usecase-card {
    animation: slideUp 0.3s ease-out;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
