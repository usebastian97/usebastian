---
import { getCollection } from 'astro:content';
import DocLayout from '@layouts/DocLayout.astro';
import { useTranslations } from '@i18n/utils';

const t = useTranslations('en');

const categoryLabels = {
  m365: t('usecases.category_m365'),
  'power-platform': t('usecases.category_power_platform'),
  'security-compliance': t('usecases.category_security_compliance'),
  'copilot-governance': t('usecases.category_copilot_governance'),
};

export async function getStaticPaths() {
  const useCaseEntries = await getCollection('use-cases');

  // If no use cases exist, return empty array to prevent build errors
  if (useCaseEntries.length === 0) {
    return [];
  }

  return useCaseEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content, headings } = await entry.render();
---

<DocLayout
  title={entry.data.title}
  description={entry.data.description}
  headings={headings}
  breadcrumb={{ label: 'Use Cases', href: '/use-cases' }}
  backLink={{ label: 'Back to Use Cases', href: '/use-cases' }}
  image={entry.data.image ?? undefined}
  showTOC={false}
  meta={[
    {
      label: 'Category',
      value: categoryLabels[entry.data.category] ?? entry.data.category,
      icon: 'ðŸ“',
    },
  ]}
>
  <!-- Challenge / Solution / Outcome cards -->
  <Fragment slot="header">
    <div class="not-prose mb-8 grid gap-3 sm:mb-10 sm:gap-4 md:grid-cols-3">
      <div
        class="rounded-lg border border-red-100 bg-gradient-to-br from-red-50 to-white p-4 sm:rounded-xl sm:p-5"
      >
        <div class="mb-2 flex items-center gap-2 sm:mb-2.5">
          <div class="flex h-7 w-7 items-center justify-center rounded-lg bg-red-100 sm:h-8 sm:w-8">
            <svg
              class="h-3.5 w-3.5 text-red-600 sm:h-4 sm:w-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
              ></path>
            </svg>
          </div>
          <h3 class="text-xs font-semibold tracking-wider text-red-700 uppercase sm:text-sm">
            Challenge
          </h3>
        </div>
        <p class="text-xs leading-relaxed text-gray-700 sm:text-sm">{entry.data.problem}</p>
      </div>

      <div
        class="rounded-lg border border-blue-100 bg-gradient-to-br from-blue-50 to-white p-4 sm:rounded-xl sm:p-5"
      >
        <div class="mb-2 flex items-center gap-2 sm:mb-2.5">
          <div
            class="flex h-7 w-7 items-center justify-center rounded-lg bg-blue-100 sm:h-8 sm:w-8"
          >
            <svg
              class="h-3.5 w-3.5 text-blue-600 sm:h-4 sm:w-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"
              ></path>
            </svg>
          </div>
          <h3 class="text-xs font-semibold tracking-wider text-blue-700 uppercase sm:text-sm">
            Solution
          </h3>
        </div>
        <p class="text-xs leading-relaxed text-gray-700 sm:text-sm">{entry.data.solution}</p>
      </div>

      <div
        class="rounded-lg border border-emerald-100 bg-gradient-to-br from-emerald-50 to-white p-4 sm:rounded-xl sm:p-5"
      >
        <div class="mb-2 flex items-center gap-2 sm:mb-2.5">
          <div
            class="flex h-7 w-7 items-center justify-center rounded-lg bg-emerald-100 sm:h-8 sm:w-8"
          >
            <svg
              class="h-3.5 w-3.5 text-emerald-600 sm:h-4 sm:w-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <h3 class="text-xs font-semibold tracking-wider text-emerald-700 uppercase sm:text-sm">
            Outcome
          </h3>
        </div>
        <p class="text-xs leading-relaxed text-gray-700 sm:text-sm">{entry.data.result}</p>
      </div>
    </div>
  </Fragment>

  <Content />

  <!-- Technologies & Related Projects -->
  <Fragment slot="footer">
    {
      entry.data.technologies && entry.data.technologies.length > 0 && (
        <div class="not-prose mt-8 rounded-lg border border-gray-200 bg-gradient-to-br from-gray-50 to-white p-4 sm:mt-12 sm:rounded-xl sm:p-6">
          <h3 class="mb-3 flex items-center gap-2 text-base font-semibold text-gray-900 sm:mb-4 sm:text-lg">
            <svg
              class="h-4 w-4 text-gray-600 sm:h-5 sm:w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"
              />
            </svg>
            Technologies Used
          </h3>
          <div class="flex flex-wrap gap-1.5 sm:gap-2">
            {entry.data.technologies.map((tech: string) => (
              <span class="rounded-md border border-gray-100 bg-white px-2 py-1 text-xs font-medium text-gray-700 shadow-sm sm:rounded-lg sm:px-3 sm:py-1.5 sm:text-sm">
                {tech}
              </span>
            ))}
          </div>
        </div>
      )
    }

    {
      entry.data.relatedProjects && entry.data.relatedProjects.length > 0 && (
        <div class="not-prose mt-8 border-t border-gray-200 pt-8">
          <h3 class="mb-4 text-lg font-semibold text-gray-900">Related Projects</h3>
          <div class="flex flex-wrap gap-3">
            {entry.data.relatedProjects.map((project: string) => (
              <a
                href={`/projects/${project}`}
                class="group inline-flex items-center gap-2 rounded-xl border-2 border-gray-200 px-4 py-2.5 text-sm font-medium text-gray-700 transition-all hover:border-gray-900 hover:bg-gray-900 hover:text-white"
              >
                {project
                  .split('-')
                  .map((word: string) => word.charAt(0).toUpperCase() + word.slice(1))
                  .join(' ')}
                <svg
                  class="h-4 w-4 transition-transform group-hover:translate-x-0.5"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5l7 7-7 7"
                  />
                </svg>
              </a>
            ))}
          </div>
        </div>
      )
    }
  </Fragment>
</DocLayout>
